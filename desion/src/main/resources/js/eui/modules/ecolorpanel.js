define(["eui/modules/uibase","eui/modules/edialog"],function(n,d){var k=n.EComponent,y=EUI.browser,h=d.EDialog;var s=["#000000","#993300","#333300","#003300","#003366","#000080","#333399","#333333","#800000","#FF6600","#808000","#008000","#008080","#0000FF","#666699","#808080","#FF0000","#FF9900","#99CC00","#339966","#33CCCC","#3366FF","#800080","#969696","#FF00FF","#FFCC00","#FFFF00","#00FF00","#00FFFF","#00CCFF","#993366","#C0C0C0","#FF99CC","#FFCC99","#FFFF99","#CCFFCC","#CCFFFF","#99CCFF","#CC99FF","#FFFFFF"],v=[1,0,0,1,1,0,0,1,0,0,1,1,0,0,1,1,0,1,1,0,0],b={borderColor:"#000000",defaultBgColor:"#FFFFFF",baseBgColor:"#FFFFFF",baseColor:"#000000"};function l(A){h.call(this,A);this._initContent(A);this.addBaseCss("eui-dialog-s");this.onclick=A.onclick;}EUI.extendClass(l,h,"EColorListPanel");l.prototype.dispose=function(){this.onclick=null;$(this.colorCon).unbind("click");l._superClass.prototype.dispose.call(this);};l.prototype._initContent=function(B){if(!B.height){B.height="500";}var A=this;this.setMaxButtonVisible(false);this.setCloseButtonVisible(false);EUI.addClassName(this.getContent(),"eui-scroll-auto");this.getContent().innerHTML="<div class='eui-panel-colorlist'><ul></ul></div>";this.liList=[];this.nameList=[];this.datas=[];this.colorCon=this.getContent().firstChild.firstChild;this.addButton("确定",null,false,true,function(){A.onclick("ok");});this.addButton("取消",null,false,false,function(){A.onclick("cancel");});var C=this.addButton("自定义",null,true,true,function(){A.onclick("custom");});EUI.addClassName(C,"eui-btn-sub");$(this.colorCon).bind("click",function(D){this.clickEventHandle(D);}.bind(this));this.addColorsPanel(B.datas);this.colorSelected(B.active);};l.prototype.addColorsPanel=function(B){if(!B){return;}for(var C=0,A=B.length;C<A;C++){this.addColor(B[C]);}};l.prototype.addColor=function(A){this.nameList.push(A.name);var C=A.isChanging;var B=A.isDel;if(!C){this._addColorPanel(A,B);}else{this._addColorChangePanel(A,B);}};l.prototype._addColorChangePanel=function(G,I){var A=G.colors;if(A.length<2){return;}var M=this.doc.createElement("li");EUI.addClassName(M,"");var K=[];K.push('<div class="eui-panel-colorlist-gradient">');K.push('<canvas  width="150px" height="30px"></canvas>');K.push("</div>");if(I){K.push('<div class="eui-panel-colorlist-del">');K.push('<i id="del" class="eui-icon eui-icon-s">&#xef7a;</i>');K.push("</div>");}M.innerHTML=K.join("");this.colorCon.appendChild(M);this.liList.push(M);this.datas.push(G);var H=M.firstChild.firstChild;var B=H.getContext("2d");var J=B.createLinearGradient(0,0,150,0);var L=A.length;var E=1/(L-1);var C=0;for(var D=0,F=L;D<F;D++){J.addColorStop(C,A[D]);C+=E;}B.fillStyle=J;B.fillRect(0,0,150,30);M.colorValue=G;};l.prototype._addColorPanel=function(G,H){var D=G.colors;var C=this.doc.createElement("li");EUI.addClassName(C,"");var B=[];B.push('<div class="eui-panel-colorlist-color">');for(var F=0,A=D.length;F<A;F++){var E=100/A;B.push('<div class="eui-panel-colorlist-color-item" style="width:'+E+"%;background-color:"+D[F]+'"></div>');}B.push("</div>");if(H){B.push('<div class="eui-panel-colorlist-del">');B.push('<i id="del" class="eui-icon eui-icon-s">&#xef7a;</i>');B.push("</div>");}C.innerHTML=B.join("");this.colorCon.appendChild(C);this.liList.push(C);this.datas.push(G);C.colorValue=G;};l.prototype.clickEventHandle=function(B){var E=B.target,F=E.getAttribute("id"),D=(F==="del");var A=r(B.target);var C=A.tagName;if(C.toUpperCase()!=="LI"){return;}if(D){this.colorDel(A);}else{this.colorSelected(A);}EUI.isFunction(this.onclick)&&this.onclick(this,A,B,D);};l.prototype.colorSelected=function(A){if(EUI.isNumber(A)){A=this.liList[A];}if(EUI.isString(A)){var B=this.nameList.indexOf(A);A=this.liList[B];}if(A==""){return;}if(!A){return;}if(this.selected!==A){EUI.removeClassName(this.selected,"eui-panel-colorlist-active");}this.selected=A;EUI.addClassName(A,"eui-panel-colorlist-active");return A;};l.prototype.colorDel=function(A){if(EUI.isNumber(A)){A=this.liList[A];}if(EUI.isString(A)){var B=this.nameList.indexOf(A);A=this.liList[B];}if(this.selected===A){this.selected=null;}var B=this.liList.indexOf(A);this.datas.splice(B,1);$(A).remove();};l.prototype.getSelectedColor=function(){if(!this.selected){return;}var A=this.selected.colorValue;return A;};l.prototype.clearColorsPanel=function(){this.selected=null;this.liList=[];this.nameList=[];this.datas=[];this.colorCon.innerHTML="";};l.prototype.refreshDatas=function(A,B){this.clearColorsPanel();this.addColorsPanel(A);this.colorSelected(B);};l.prototype.setOnClick=function(A){this.onclick=A;};function r(C){var A=C.tagName;var B=0;while(A!=="LI"&&B<5){if(A==="LI"){break;}C=C.parentNode;A=C.tagName;B++;}return C;}function o(A){k.call(this,A);this._initFillContent(A);}EUI.extendClass(o,k,"ECustomColorPanel");o.prototype.dispose=function(){this.colorpanel.dispose();if(this.colorFillSecond){$(this.colorFillSecond).unbind("click");this.colorFillSecond=null;}if(this.colorFillThird){this.colorFillThird=null;}if(this.radioGroup){this.radioGroup.dispose();this.radioGroup=null;}if(this.menu){this.menu.dispose();this.menu=null;}o._superClass.prototype.dispose.call(this);};o.prototype._initFillContent=function(L){var A=[],J=L.parentElement,C=J.appendChild(this.doc.createElement("div"));this.colorList=[];this.colorCanvas=[];this.gradient=L.gradient;C.className="eui-panel-customcolor";A.push('<div class="eui-panel-customcolor-top">');A.push('<button class="eui-btn eui-btn-m eui-btn-text eui-float-right" type="button">');A.push(I18N.getString("resources/eui/modules/ecolorpanel.js.clear","清空"));A.push("</button>");A.push("</div>");A.push('<div class="eui-panel-customcolor-center">');A.push('<div class="eui-panel-customcolor-add">');A.push('<i id="add" class="eui-icon eui-btn eui-btn-m eui-btn-icon">&#xef79');A.push("</i>");A.push("</div>");A.push("</div>");A.push('<div class="eui-panel-customcolor-bottom">');A.push('<canvas  width="150px" height="30px">');A.push("</canvas>");A.push("</div>");C.innerHTML=A.join("");var H=C.firstChild;var F=H.nextSibling;var D=F.firstChild;var I=F.nextSibling;var E={data:[{value:"a",caption:"渐变填充"},{value:"b",caption:"色块填充"}],value:"a",parentElement:H,type:"radio"};var B=require("eui/modules/ecommonctrls").EFormCheckBoxGroup;var G=new B(E);var K=this;G.setOnClick(function(){if(G.getValue()=="b"){if(K.colorList.length<15){EUI.removeClassName(document.getElementById("add"),"eui-hide");}else{EUI.addClassName(document.getElementById("add"),"eui-hide");}K.addCanvasDiv(K.gradientHandle());EUI.addClassName(I,"eui-hide");}else{if(!K.gradient){if(K.colorList.length<2){EUI.removeClassName(document.getElementById("add"),"eui-hide");}else{EUI.addClassName(document.getElementById("add"),"eui-hide");K.addCanvasDiv(K.gradientHandle());}}else{if(K.colorList.length>14){EUI.addClassName(document.getElementById("add"),"eui-hide");}else{EUI.removeClassName(document.getElementById("add"),"eui-hide");}K.addCanvasDiv(K.colorList);}EUI.removeClassName(I,"eui-hide");}});$(F).bind("click",function(M){this.clickEventHandle(M);}.bind(this)).bind("contextmenu",function(M){M.preventDefault();this.contextmenuEventHandle(M);}.bind(this));$(H.firstChild).bind("click",function(M){this.clickClearEventHandle(M);}.bind(this));this.radioGroup=G;this.container=C;this.colorFillFirst=H;this.colorFillSecond=F;this.colorAdd=D;this.colorFillThird=I;};o.prototype.gradientHandle=function(){this.colorCanvas=[];if(!this.gradient){if(this.colorList.length>2){this.colorCanvas[0]=this.colorList[0];this.colorCanvas[1]=this.colorList[1];}else{this.colorCanvas=this.colorList;}}else{this.colorCanvas=this.colorList;}return this.colorCanvas;};o.prototype.clickEventHandle=function(A){this.divFill=A.target;var C=this.divFill.getAttribute("id");var B=this.divFill.className;if(C=="add"){this.clicktype="add";this._initAddColorDom(A);}else{if(C=="colorfill"){this.clicktype="change";this._initAddColorDom(A);}}};o.prototype.clickClearEventHandle=function(A){if(this.colorFillSecond){var C=this.doc.getElementsByClassName("eui-panel-customcolor-item");$(C).remove();this.colorList=[];}if(this.colorFillThird){var B=this.colorFillThird.firstChild.getContext("2d");B.clearRect(0,0,150,30);}EUI.removeClassName(document.getElementById("add"),"eui-hide");};o.prototype.contextmenuEventHandle=function(A){var D=A.target,E=D.getAttribute("id");if(E=="colorfill"&&!this.menu){var C=require("eui/modules/emenu").EPopupMenu;this.menu=new C({wnd:window,baseCss:"emenu"});this.menuItem=this.menu.addEMenuItem("删除");}var B=this;this.menuItem.setOnClick(function(){var F=$(D).index();$(D).remove();B.colorList.splice(F,1);var G=B.radioGroup.getValue();if(G=="b"){if(B.colorList.length<15){EUI.removeClassName(document.getElementById("add"),"eui-hide");}else{EUI.addClassName(document.getElementById("add"),"eui-hide");}B.addCanvasDiv(B.gradientHandle());EUI.addClassName(B.colorFillThird,"eui-hide");}else{if(!B.gradient){if(B.colorList.length<2){EUI.removeClassName(document.getElementById("add"),"eui-hide");B.addCanvasDiv(B.gradientHandle());EUI.addClassName(B.colorFillThird,"eui-hide");}else{EUI.addClassName(document.getElementById("add"),"eui-hide");B.addCanvasDiv(B.gradientHandle());EUI.removeClassName(B.colorFillThird,"eui-hide");}}else{if(B.colorList.length<15){EUI.removeClassName(document.getElementById("add"),"eui-hide");}else{EUI.addClassName(document.getElementById("add"),"eui-hide");}B.addCanvasDiv(B.gradientHandle());EUI.removeClassName(B.colorFillThird,"eui-hide");}}});this.menu.popupAtPosition(A.clientX,A.clientY);};o.prototype._initAddColorDom=function(A){var B=this;if(!this.colorpanel){if(!this.r){var C=this.doc.createElement("div");C.className="eui-panel-hide";C.style.cssText+=";width: 256px; height: 430px;";this.doc.body.appendChild(C);this.colorpanel=new t({wnd:this.wnd,parentElement:C,isOpacityVisiable:false,showCancelBtn:true,showApplyBtn:false,onapply:function(D){if(D=="ok"){B._XColorPickerOnClick();}else{B.r.setVisible(false);}},onswitch:function(E,D){B._colorPanelSwitch(B.r,A,E,"onswitch");}});this.r=new n.EFloatDiv({width:256,height:430,wnd:this.wnd,parentElement:this.doc.body,moveHandle:this.colorpanel.options.colorFooter,onVisible:function(E,D){B.evtforpick(D);}});this.r.setResize(false);this.r.getDom().appendChild(C.firstChild);this.doc.body.removeChild(C);$(this.r).on("mousedown",function(D){D.stopPropagation();});}}this._eventbind_handler=this.handlerCloseEvent.bind(this);this.r.setVisible(true);this._colorPanelSwitch(this.r,A,!this.isHidden);};o.prototype.isPartofDom=function(D){var A=this.getBaseDom();var B=this.r;if(B){var C=B.getBaseDom();}if(this.menu){var E=this.menu.getBaseDom();}return(EUI.isChildNode(A,D,true))||(C&&EUI.isChildNode(C,D,true))||(EUI.isChildNode(E,D,true));};o.prototype.evtforpick=function(A){if(A){EUI.attacheEvent4TopIframes("add","mousedown",this._eventbind_handler);EUI.attacheEvent4TopIframes("add","mousewheel",this._eventbind_handler);}else{EUI.attacheEvent4TopIframes("remove","mousedown",this._eventbind_handler);EUI.attacheEvent4TopIframes("remove","mousewheel",this._eventbind_handler);}};o.prototype.handlerCloseEvent=function(D){var A=this.r;if(!A){return;}var B=A.getBaseDom();D=D||widnow.event;var C=D.srcElement||D.target;if(!C){return;}if(EUI.isChildNode(B,C,true)){D.stopPropagation?D.stopPropagation():(D.cancelBubble=true);return;}A.setVisible(false);};o.prototype._XColorPickerOnClick=function(){var A=this.colorpanel.getEditValue();if(this.clicktype=="add"){this.addColorDiv(A);}else{if(this.clicktype=="change"){this.changeColorDiv(this.divFill,A);}}if(!this.gradient){this.addCanvasDiv(this.gradientHandle());}else{this.addCanvasDiv(this.colorList);}var B=this.radioGroup.getValue();if(B=="a"){EUI.removeClassName(this.colorFillThird,"eui-hide");}else{if(B=="b"){EUI.addClassName(this.colorFillThird,"eui-hide");}}this.r.setVisible(false);this.divFill=null;};o.prototype._colorPanelSwitch=function(D,A,C){var B=this.colorpanel;var G=this.doc.body.offsetHeight-A.clientY;if(!B){return;}if(arguments[3]){var F=this.r.getBaseDom().offsetTop;if(!C){D.getBaseDom().style.height="368px";if(D.stayplace=="up"){var E=F+52;D.getBaseDom().style.top=E+"px";}else{D.getBaseDom().style.top=F+"px";}}else{D.getBaseDom().style.height="420px";if(D.stayplace=="up"){var E=F-52;D.getBaseDom().style.top=E+"px";}else{D.getBaseDom().style.top=F+"px";}}}else{if(!C){if(G<368){D.setBounds(A.clientX,A.clientY-368,256,368);D.stayplace="up";}else{D.setBounds(A.clientX,A.clientY,256,368);D.stayplace="down";}}else{if(G<420){D.setBounds(A.clientX,A.clientY-420,256,420);D.stayplace="up";}else{D.setBounds(A.clientX,A.clientY,256,420);D.stayplace="down";}}}this.isHidden=!C;};o.prototype.addColorDiv=function(A){if(A==""){return;}var C=this.doc.createElement("div");C.className="eui-panel-customcolor-item";C.setAttribute("id","colorfill");C.style.backgroundColor=A;this.colorFillSecond.insertBefore(C,this.colorAdd);this.colorList.push(A);var B=this.radioGroup.getValue();if(this.colorList.length>1&&B=="a"&&!this.gradient){EUI.addClassName(document.getElementById("add"),"eui-hide");}else{if(this.colorList.length>14&&B=="b"){EUI.addClassName(document.getElementById("add"),"eui-hide");}}};o.prototype.addCanvasDiv=function(C){if(C.length<2){return;}var G=this.colorFillThird.firstChild.getContext("2d");var D=G.createLinearGradient(0,0,150,0);var B=C.length;var H=1/(B-1);var E=0;for(var F=0,A=B;F<A;F++){D.addColorStop(E,C[F]);E+=H;}G.fillStyle=D;G.fillRect(0,0,150,30);};o.prototype.changeColorDiv=function(C,A){C.style.backgroundColor=A;var B=$(C).index();this.colorList.splice(B,1,A);};o.prototype.getPanelValue=function(){if(!this.colorList){return;}var A={};var B=this.radioGroup.getValue();if(B=="a"){var C=true;}else{var C=false;}return{colorObj:{colors:this.colorList,name:"新增方案"+(Math.floor(Math.random()*999)),isDel:true,isChanging:C}};};o.prototype.clearPanel=function(){$(this.colorFillSecond).remove();if(!this.colorFillThird){return;}$(this.colorFillThird).remove();};o.prototype.getBaseDom=function(){return this.container;};function z(A){k.call(this,A);this._currentColor="";this._initXColorPanel();this.onswitch=A.onswitch;this.onclick=A.onclick;}EUI.extendClass(z,k,"EColorPanel");z.DEFAULT_ID="ESEN$XColorPanel";z.dec2Hex=function(D){var C="0123456789ABCDEF";var B,A;D=Math.round(D);A=D%16;B=Math.floor((D/16))%16;return(C.charAt(B)+C.charAt(A));};z.rgbn2Html=function(C,B,A,D){C=((C*16+C)*3*(15-D)+128*D)/15;B=((B*16+B)*3*(15-D)+128*D)/15;A=((A*16+A)*3*(15-D)+128*D)/15;return"#"+z.dec2Hex(C)+z.dec2Hex(B)+z.dec2Hex(A);};z.color2Html=function(G,B){var E,D,A;var F=G.indexOf("(");var C=G.indexOf(")");if(F!=-1&&C!=-1){G=G.substring(F+1,C);G=G.split(",");E=parseInt(G[0]);D=parseInt(G[1]);A=parseInt(G[2]);}else{E=parseInt(G.substring(1,3),16);D=parseInt(G.substring(3,5),16);A=parseInt(G.substring(5,7),16);}if(B>120){B=B-120;E=(E*(120-B)+255*B)/120;D=(D*(120-B)+255*B)/120;A=(A*(120-B)+255*B)/120;}else{E=(E*B)/120;D=(D*B)/120;A=(A*B)/120;}return"#"+z.dec2Hex(E)+z.dec2Hex(D)+z.dec2Hex(A);};z.prototype.dispose=function(){if(this._moreAdvButton){this._moreAdvButton.self=null;this._moreAdvButton.onclick=null;this._moreAdvButton.onmouseover=null;this._moreAdvButton.onmouseout=null;this._moreAdvButton=null;}if(this._miniBaseButton){this._miniBaseButton.self=null;this._miniBaseButton.onclick=null;this._miniBaseButton.onmouseover=null;this._miniBaseButton.onmouseout=null;this._miniBaseButton=null;}if(this._colorBody){this._colorBody.self=null;this._colorBody.ondblclick=null;this._colorBody.onclick=null;this._colorBody=null;}if(this._shadeColorBody){this._shadeColorBody.self=null;this._shadeColorBody.onclick=null;this._shadeColorBody.onmouseover=null;this._shadeColorBody=null;}if(this._baseColorPane){this._baseColorPane.self=null;this._baseColorPane.onclick=null;this._baseColorPane.onmouseover=null;this._baseColorPane=null;}if(this.colorInput){this.colorInput._sancomponent=null;this.colorInput.onkeydown=null;this.colorInput=null;}if(this._nullColor){this._nullColor._sancomponent=null;this._nullColor.onclick=null;this._nullColor=null;}if(this._transparentColor){this._transparentColor._sancomponent=null;this._transparentColor.onclick=null;this._transparentColor=null;}this.onclick=null;this.onswitch=null;this.config=null;this._cloneBlock=null;this._currentColor=null;this._currentBaseColor=null;this._currentAdvColor=null;k.prototype.dispose.call(this);};z.prototype._initXColorPanel=function(){this._colorPane=this.parentElement.appendChild(this.doc.createElement("table"));this.basedom=this._colorPane;this._colorPane.id=EUI.idRandom(z.DEFAULT_ID);this._colorPane.border=0;this._colorPane.cellPadding=0;this._colorPane.cellSpacing=0;this._colorPane.bgColor=b.baseBgColor;this.infoRow=this._colorPane.insertRow(-1).insertCell(-1);this.infoRow.vAlign="middle";this.infoRow.style.padding="4px";this.infoRow.style.paddingLeft=0;this.infoRow.style.paddingRight=0;this._makeInfoPane();this._makeBaseColorPane();this.setVisibleMoreButton(true);};z.prototype.setVisibleMoreButton=function(A){if(typeof(A)!="boolean"){A=true;}if(this.ismorebtnvisible===A){return;}this.ismorebtnvisible=A;this._baseColorRow.style.display=this._moreAdvButton.style.display=A?"":"none";this._miniBaseButton.style.display=A?"none":"";if(this._colorRow&&this._shadePanelColorRow&&this._shadeColorRow){this._colorRow.style.display=this._shadePanelColorRow.style.display=this._shadeColorRow.style.display=A?"none":"";if(!A&&this._currentColor){this.resetShadeColor(this._currentColor);}}if(typeof(this.onswitch)=="function"){this.onswitch(this);}};z.prototype.isMoreBtnVisible=function(){return this.ismorebtnvisible;};z.prototype.isVisibleShadeColor=function(){return this._shadePanelColorRow&&this._shadeColorRow&&this._shadePanelColorRow.style.display!="none"&&this._shadeColorRow.style.display!="none";};z.prototype.getContainer=function(){return this._colorPane;};z.prototype.getBaseDom=z.prototype.getContainer;z.prototype.setTransparentColorVisible=function(B){if(typeof(B)!="boolean"){B=false;}var A=B?"":"none";if(this._transparentColor.style.display!=A){this._transparentColor.style.display=A;}};z.prototype._makeInfoPane=function(){var A=this._nullColor=this.infoRow.appendChild(this.doc.createElement("img"));A.title=I18N.getString("xui.ctrls.xcolorpanel.js.1","无填充颜色");A.src=EUI.xuiimg("picker/clear.gif");A.style.cssText+="; cursor: pointer; float: left; width: 12px; margin: 2px 0 0 2px;";this._transparentColor=this.infoRow.appendChild(this.doc.createElement("img"));this._transparentColor.title="透明色";this._transparentColor.src=EUI.xuiimg("picker/defcolor.gif");this._transparentColor.style.cssText+="; cursor: pointer; float: left;";this._preColorPane=this.infoRow.appendChild(this.doc.createElement("div"));this._preColorPane.style.cssText+="; float: left; font-size: 1px; width: 10px; height: 10px; margin-top: 3px; border: 1px solid "+b.borderColor;this._titlePane=this.infoRow.appendChild(this.doc.createElement("div"));this._titlePane.style.cssText+="; float: left; font-size: 12px; font-weight: bold; width: 60px; height: 16px; line-height:16px;";this.colorInput=this._titlePane.appendChild(this.doc.createElement("input"));this.colorInput.UNSELECTABLE="off";this.colorInput.style.cssText+="; border: none; width: 100%; -moz-user-select: text; font-size: 12px; background: #FFF; padding-left: 5px;";this._moreAdvButton=this.infoRow.appendChild(this.doc.createElement("i"));this._moreAdvButton.className="eui-icon eui-icon-xs eui-float-right";this._moreAdvButton.style.lineHeight="16px";this._moreAdvButton.style.color="#000";this._moreAdvButton.style.cursor="pointer";this._moreAdvButton.innerHTML="&#xef81;";this._moreAdvButton.setAttribute("title","高级色彩");this._miniBaseButton=this.infoRow.appendChild(this.doc.createElement("i"));this._miniBaseButton.className="eui-icon eui-icon-xs eui-float-right";this._miniBaseButton.style.lineHeight="16px";this._miniBaseButton.style.color="#000";this._miniBaseButton.style.cursor="pointer";this._miniBaseButton.innerHTML="&#xef80;";this._miniBaseButton.setAttribute("title","基础色彩");this._moreAdvButton.onclick=m;this._miniBaseButton.onclick=w;this._nullColor._sancomponent=this;this._nullColor.onclick=g;this._transparentColor._sancomponent=this;this._transparentColor.onclick=u;this.colorInput._sancomponent=this;this.colorInput.onkeydown=f;this._moreAdvButton.self=this;this._miniBaseButton.self=this;};z.prototype._initAdvColor=function(){this._makeAdvColorPane();this._makeShadeColorPane();};z.prototype._makeAdvColorPane=function(){this._colorRow=this._colorPane.insertRow(-1);this._colorBody=this._colorRow.insertCell(-1).appendChild(this.doc.createElement("table"));this._colorBody.border=0;this._colorBody.cellPadding=0;this._colorBody.cellSpacing=0;this._colorBody.style.cursor="default";var I,H,G,E,D,F,C;for(var B=0;B<16;B++){I=this._colorBody.insertRow(-1);for(var A=0;A<30;A++){H=I.insertCell(-1);G=A%5;E=Math.floor(A/5)*3;D=E+3;H.style.width="10px";H.style.height="10px";C=z.rgbn2Html((v[D]*G+v[E]*(5-G)),(v[D+1]*G+v[E+1]*(5-G)),(v[D+2]*G+v[E+2]*(5-G)),B);F=H.appendChild(this._cloneBlock.cloneNode(false));F.style.borderRightWidth=0;F.style.borderBottomWidth=0;F.style.backgroundColor=F.title=F.bgColor=C;}}this._colorBody.onclick=q;this._colorBody.ondblclick=a;this._colorBody.self=this;};z.prototype.resetShadeColor=function(A){for(var B=0;B<=30;B++){this._shadeColorRow.cells[B].bgColor=z.color2Html(A,240-B*8);}};z.prototype._makeShadeColorPane=function(){this._shadePanelColorRow=this._colorPane.insertRow(-1);this._shadeColorBody=this._shadePanelColorRow.insertCell(-1).appendChild(this.doc.createElement("table"));this._shadeColorBody.parentNode.style.border="1px solid "+b.borderColor;this._shadeColorBody.border=0;this._shadeColorBody.cellPadding=0;this._shadeColorBody.cellSpacing=0;this._shadeColorBody.width="100%";this._shadeColorBody.style.cursor="default";this._shadeColorRow=this._shadeColorBody.insertRow(-1);var A;for(var B=255;B>=0;B-=8.5){A=this._shadeColorRow.insertCell(-1);A.bgColor="#"+z.dec2Hex(B)+z.dec2Hex(B)+z.dec2Hex(B);A.title=Math.floor(B*16/17);A.style.height="15px";A.style.cursor="pointer";if(y.isChrome||y.isSafari){A.style.width="9px";A.style.border="1px";}}this._shadeColorBody.onclick=p;this._shadeColorBody.onmouseover=c;this._shadeColorBody.self=this;};z.prototype.getColor=function(){var A=this._currentColor;return !A?"":A!=="transparent"?z.color2Html(this._currentColor,120):"transparent";};z.prototype.setColor=function(A){if(typeof(A)=="string"){if(A){A=A.toUpperCase();if(/^[0-9A-F]+$/g.test(A.substring(1))){this.colorInput.value=this._preColorPane.style.backgroundColor=this._currentColor=A;if(this.isVisibleShadeColor()){this.resetShadeColor(A);}}else{this.colorInput.value=this._preColorPane.style.backgroundColor=this._currentColor="transparent";}}else{this._preColorPane.style.backgroundColor=this._currentColor="";this.colorInput.value="无颜色";}}};z.prototype.setOnClick=function(A){this.onclick=A;};z.prototype.setOnSwitch=function(A){this.onswitch=A;};z.prototype.hidden=function(){this.setVisible(false);};z.prototype.show=function(){this.setVisibleMoreButton(true);this.setVisible(true);};function p(B){var A=this.self;if(!A){return;}if(typeof(A.onclick)=="function"){A.onclick(A);}}function c(C){var A=this.self;if(!A){return false;}if(!C){C=A.wnd.event;}var B=C.target?C.target:C.srcElement;if(!"TD".equalsIgnoreCase(B.tagName)){return false;}A._currentColor=B.bgColor.toUpperCase();A.colorInput.value=A._preColorPane.style.backgroundColor=A._currentColor;if(A._currentAdvColor){A._currentAdvColor.style.border="1px solid "+b.defaultBgColor;A._currentAdvColor.style.borderRightWidth=0;A._currentAdvColor.style.borderBottomWidth=0;}return true;}function q(C){var A=this.self;if(!A){return false;}if(!C){C=A.wnd.event;}var B=C.target?C.target:C.srcElement;if(!"DIV".equalsIgnoreCase(B.tagName)){return false;}A._currentColor=B.bgColor.toUpperCase();A.colorInput.value=A._preColorPane.style.backgroundColor=A._currentColor;A.resetShadeColor(B.bgColor);if(A._currentAdvColor==null){A._currentAdvColor=B;}else{A._currentAdvColor.style.border="1px solid "+b.borderColor;A._currentAdvColor.style.borderRightWidth=0;A._currentAdvColor.style.borderBottomWidth=0;A._currentAdvColor=B;}B.style.border="1px solid "+b.defaultBgColor;B.style.borderRightWidth=0;B.style.borderBottomWidth=0;return true;}function a(B){var A=this.self;if(!A){return;}if(typeof(A.onclick)=="function"){A.onclick(A);}}function g(B){var A=this._sancomponent;if(!A){return;}A._preColorPane.style.backgroundColor=A._currentColor=A.colorInput.value="";if(typeof(A.onclick)=="function"){A.onclick(A);}}function u(B){var A=this._sancomponent;if(!A){return;}A._preColorPane.style.backgroundColor=A._currentColor=A.colorInput.value="transparent";if(typeof(A.onclick)=="function"){A.onclick(A);}}function f(C){var B=this._sancomponent;if(!B){return;}if(!C){C=B.wnd.event;}var A=C.keyCode;if(A==27){}else{if(A==13){B._preColorPane.style.backgroundColor=B._currentColor=this.value?this.value.toUpperCase():"";if(typeof(B.onclick)=="function"){B.onclick(B);}if(C.preventDefault){C.preventDefault();}else{C.returnValue=false;}}}}function m(){var A=this.self;if(!A){return;}if(!A._colorRow){A._initAdvColor();}A.setVisibleMoreButton(false);}function w(){var A=this.self;if(!A){return;}A.setVisibleMoreButton(true);}z.prototype._makeBaseColorPane=function(){if(!this._cloneBlock){this._cloneBlock=this.doc.createElement("div");this._cloneBlock.className="eui-colorPanel-col";}this._baseColorRow=this._colorPane.insertRow(-1);this._baseColorPane=this._baseColorRow.insertCell(-1).appendChild(this.doc.createElement("table"));this._baseColorPane.border=0;this._baseColorPane.cellPadding=0;this._baseColorPane.cellSpacing=4;this._baseColorPane.bgColor=b.baseBgColor;this._baseColorPane.style.cursor="default";var C,A;for(var B=0;B<s.length;B++){if((B%8)==0){C=this._baseColorPane.insertRow(-1);}if(!C){C=this._baseColorPane.insertRow(-1);}A=C.insertCell(-1).appendChild(this._cloneBlock.cloneNode(false));A.style.backgroundColor=A.title=A.bgColor=s[B];}this._baseColorPane.onclick=i;this._baseColorPane.onmouseover=x;this._baseColorPane.self=this;};function i(C){var A=this.self;if(!A){return false;}if(!C){C=A.wnd.event;}var B=C.target?C.target:C.srcElement;if(!"DIV".equalsIgnoreCase(B.tagName)){return false;}A._currentColor=B.bgColor.toUpperCase();A.colorInput.value=A._preColorPane.style.backgroundColor=A._currentColor;if(typeof(A.onclick)=="function"){A.onclick(A);}return true;}function x(C){var A=this.self;if(!A){return false;}if(!C){C=A.wnd.event;}var B=C.target?C.target:C.srcElement;if(!"DIV".equalsIgnoreCase(B.tagName)){return false;}if(A._currentBaseColor==null){A._currentBaseColor=B;}else{A._currentBaseColor.style.border="1px solid "+b.borderColor;A._currentBaseColor=B;}B.style.border="1px solid "+b.defaultBgColor;A._currentColor=B.bgColor.toUpperCase();A.colorInput.value=A._preColorPane.style.backgroundColor=A._currentColor;return true;}var e=["#d8210d","#f44336","#ff2d55","#ff9500","#ffcc00","#008077","#13ae67","#4cd964","#9dc92a","#cfdc28","#c3e2cd","#002f7b","#007bbb","#007aff","#34aadc","#5ac8fa","#bbe2f1","#673ab7","#9c27b0","#5856d6","#000000","#595959","#737373","#8b8b8b","#a0a0a0","#b7b7b7","#cbcbcb","#dfdfdf","#f0f0f0","#ffffff"];function t(A){k.call(this,A);this._currentColor=A.color;this.commonColors=A.commonColors||e;this.isCommonVisiable=EUI.parseBool(A.isCommonVisiable,true);this.isSelectVisiable=EUI.parseBool(A.isSelectVisiable,true);this.isOpacityVisiable=EUI.parseBool(A.isOpacityVisiable,true);this.showCommonColor=EUI.parseBool(A.showCommonColor,true);this.initERichColorPanel(A);this.onapply=A.onapply;this.onswitch=A.onswitch;}EUI.extendClass(t,k,"ERichColorPanel");t.prototype.dispose=function(){this.unBindEvent();if(this.rangeColor){this.rangeColor.dispose();this.rangeColor=null;}if(this.rangeOpacity){this.rangeOpacity.dispose();this.rangeOpacity=null;}this.options=null;this._currentColor=null;this.startMoving=null;this.changeType=null;this.isCommonVisiable=null;this.isSelectVisiable=null;this.onapply=null;this.onswitch=null;this.isOpacityVisiable=null;this.commonColors=null;};t.prototype.initERichColorPanel=function(D){var A=D,B=[],E=A.parentElement,I=E.appendChild(this.doc.createElement("div"));this.basedom=I;I.className="eui-color-container ";B.push('<div class="eui-color-main">');B.push('<div class="eui-color-main-white"></div>');B.push('<div class="eui-color-main-black"></div>');B.push('<div class="eui-color-main-pointer"></div>');B.push("</div>");B.push('<div class="eui-color-alphp">');B.push('<div class="eui-color-show"></div>');B.push('<div class="eui-color-colorblock">');B.push('<div class="eui-color-colorshow-img"></div>');B.push("</div>");B.push('<div class="eui-color-alphpshow">');B.push('<div class="eui-color-alphpshow-img">');B.push('<div class="eui-color-alphpshow-color"></div>');B.push("</div>");B.push("</div>");B.push("</div>");B.push('<div class="eui-color-value eui-form-container eui-form-label-xs">');B.push('<div class="eui-form-item" style="display:inline-block;">');B.push('<label class="eui-form-label">色值：</label>');B.push('<div class="eui-input-block">');B.push('<input type="text" class="eui-form-input" style="width:130px;">');B.push("</div>");B.push("</div>");B.push('<img style="cursor: pointer;float:right;margin-right:20px;margin-top:3px;" title="透明" src='+EUI.xuiimg("picker/no-color.png")+">");B.push("</div>");B.push('<div class="eui-color-lately">');B.push('<div class="eui-hr"></div>');B.push('<span class="eui-tips-container">最近使用的颜色</span>');B.push('<ul class="eui-color-empty-list" style="height: 22px;">');B.push('<div class="eui-icon eui-icon-xs eui-icon-primary" style="margin-left:238px;"></div>');B.push("</ul>");B.push('<ul class="eui-color-item-list" style="height: 22px; overflow: hidden"></ul>');B.push("</div>");B.push('<div class="eui-color-footer" style="display: inline-block; width: 100%;">');B.push('<div class="eui-hr"></div>');B.push('<div class="btn-container"style="float:right;margin-right:10px;">');B.push('<div class="eui-btn eui-btn-m eui-btn-primary" type="button">确定</div>');B.push('<div class="eui-btn eui-btn-m" type="button">应用</div>');B.push('<div class="eui-btn eui-btn-m" type="button">取消</div>');B.push("</div>");B.push("</div>");I.innerHTML=B.join("");var L=I.firstChild,N=L.lastChild,M=L.nextSibling,C=M.firstChild,H=C.nextSibling,F=M.lastChild,P=M.nextSibling,O=$(P).find("input")[0],S=P.lastChild,Q=P.nextSibling,U=Q.childNodes[2],R=U.firstChild,G=U.nextSibling,K=Q.nextSibling,T=K.lastChild.firstChild,J=T.nextSibling;this.options={mainColor:L,choosePointer:N,alphpColor:M,showColor:C,rangeColorDom:H,rangeOpacityDom:F,valueColor:P,edit:O,transParentDom:S,colorsPanel:Q,selectColorDom:U,colorCommonDom:G,listDownIcon:R,colorFooter:K,okButton:T,applyButton:J,cancelButton:J.nextSibling};this.initEformRangeItem();this.initSelectColor();this.initCanvas();this.setRangeColor(this._currentColor);this.setRangeOpacity(D.panelOpacity);this.bindEvent();this.mainColorWidth=L.offsetWidth;this.mainColorHeight=L.offsetHeight;this.addCommonColor();this.setCommonColorVisiable(this.isCommonVisiable);this.setSelectColorVisiable(this.isSelectVisiable);this.setOpacityVisiable(this.isOpacityVisiable);this.setButtonVisiable("cancel",EUI.parseBool(D.showCancelBtn,false));this.setButtonVisiable("apply",EUI.parseBool(D.showApplyBtn,true));if(!D.color){this.setEditValue("");}this.switchColorPanel(this.showCommonColor,false);};t.prototype.initEformRangeItem=function(){var A=this,C=this.options;var B=require("eui/modules/ecommonctrls").EFormRange;if(!this.rangeColor){this.rangeColor=new B({wnd:A.wnd,parentElement:C.rangeColorDom,width:"100%",maxvalue:359,minvalue:0,runstep:1,enableMoveChange:true,onchange:function(E,D){A.onChangeColor(D);}});}if(!this.rangeOpacity){this.rangeOpacity=new B({wnd:A.wnd,parentElement:C.rangeOpacityDom,width:"100%",maxvalue:1,minvalue:0,runstep:0.01,enableMoveChange:true,onchange:function(E,D){A.onChangeOpacity(D);}});}};t.prototype.initSelectColor=function(){var B=this.options,C='<li class="eui-color-empty"></li>';for(var A=0;A<10;A++){B.selectColorDom.innerHTML+=C;}};t.prototype.initCanvas=function(){var F=this.options,D=F.rangeColorDom.firstChild,G=D.offsetWidth,A=D.offsetHeight;D.innerHTML='<canvas width="'+G+'" height="'+A+'"></canvas>';var E=D.firstChild;var C=E.getContext("2d");var B=C.createLinearGradient(0,0,G,0);B.addColorStop(0,"#F00");B.addColorStop(0.16,"#FF0");B.addColorStop(0.32,"#0F0");B.addColorStop(0.48,"#0FF");B.addColorStop(0.65,"#00F");B.addColorStop(0.81,"#F0F");B.addColorStop(1,"#F00");C.fillStyle=B;C.fillRect(0,0,G,A);};t.prototype.setColor=function(A){if(A==""){var B=true;}else{if(A=="transparent"){this.setRangeOpacity(0);A="";var C="transparent";}}A=A?A:this._currentColor;A=A.charAt(0)=="#"?j.HEX2RGB(A):A;this.setTotalColor(A,C,B);};t.prototype.setTotalColor=function(A,E,B){this.setShowColor(A,E);this.setEditValue(A,E,B);this.setOpacityRangeColor(A);this.setPointBycolor(A);var C=j.RGB2HSB(A);this.rangeColor.setValue(C[0],false);var D=this.hsbToRgb(C[0]);A="rgb("+D[0]+","+D[1]+","+D[2]+")";this.setMainColor(A);};t.prototype.addCommonColor=function(){if(!this.commonColors){return;}var B=this.commonColors;for(var C=0,A=B.length;C<A;C++){this._doAddColor(B[C]);}};t.prototype._doAddColor=function(A){A=A.charAt(0)=="#"?j.HEX2RGB(A):A;var B=this.doc.createElement("li");B.className="eui-color-item";var D=j.RGB2ARR(A);D[0]=Math.max(0,parseInt(D[0],10)-20);var C="rgb("+D[0]+","+D[1]+","+D[2]+")";B.style.cssText+=";background-color:"+A+";border-color:"+C+";";this.options.colorCommonDom.appendChild(B);};t.prototype.setRangeColor=function(A){A=A?A:"#ff0000";A=A.charAt(0)=="#"?j.HEX2RGB(A):A;if(!A){return;}var B=j.RGB2HSB(A);this.rangeColor.setValue(B[0]);};t.prototype.setRangeOpacity=function(B){B=EUI.isNumber(B)?B:1;this.rangeOpacity.setValue(B);var A=this.options.showColor.style;if(B==0){A.backgroundImage="url("+EUI.xuiimg("picker/shadow.png")+")";A.cssText+=";opacity:unset;background-color:transparent;border:none;";}else{this.options.showColor.style.backgroundImage="none";if(A.border==="none"){A.border="";}}};t.prototype.bindEvent=function(){var A=this,B=A.options;$(B.mainColor).bind("mousedown.erich",function(C){A.onPanelMouseDown(C);});$(B.edit).bind("keyup.erich",function(C){A.onEditValueChange(C);});$(B.colorsPanel).bind("click.erich",function(C){A._onColorsPanelMouseDown(C);});$(B.transParentDom).bind("click.trans",function(){A.onTransParentClick();});$(B.colorFooter).bind("mouseup.erich",function(C){var D=C.target;if(D==B.okButton){A._doApply("ok");}else{if(D==B.applyButton){A._doApply("apply");}else{if(D==B.cancelButton){A._doApply("cancel");}}}});};t.prototype.unBindEvent=function(){var A=this.options;$(A.mainColor).unbind("mousedown.erich");$(A.edit).unbind("keyup.erich");$(A.colorsPanel).unbind("click.erich");$(A.colorFooter).unbind("mouseup.erich");$(A.transParentDom).unbind("click.trans");};t.prototype._doApply=function(C){var A=this.getEditValue();var B=this.ensureColor(A);if(C!="cancel"&&B){this.addSelectColorItem(A);}if(EUI.isFunction(this.onapply)){return this.onapply(C,this.getEditValue(),this,B);}};t.prototype.setOnApply=function(A){this.onapply=A;};t.prototype.ensureColor=function(B){if(B=="transparent"||B===""){return true;}var C=B.slice(1),A=B.substr(0,1);if((C.length==3||C.length==6)&&A=="#"){return true;}else{return false;}};t.prototype.switchColorPanel=function(C,D){var B=this.options,A=B.colorCommonDom;D=EUI.parseBool(D,true);if(C){A.style.cssText+=";overflow:auto;height:auto;";}else{A.style.cssText+=";overflow:hidden;height:25px;";}B.isHidden=C;if(D&&EUI.isFunction(this.onswitch)){this.onswitch(C,this);}};t.prototype.onPanelMouseDown=function(A){var B=this,C=this.options;EUI.disableDocTextSelect(this.basedom,false);this.mainColorRect=C.mainColor.getBoundingClientRect();this.setColorByPoint(A.clientX,A.clientY);this.startMoving=true;$(this.doc.body).bind("mousemove.erich",function(D){B.onPanelMouseMove(D);});$(this.doc.body).bind("mouseup.erich mouseleave.erich",function(D){B.onPanelMouseUp(D);});};t.prototype.onPanelMouseMove=function(A){if(this.startMoving===true){this.setColorByPoint(A.clientX,A.clientY);}};t.prototype.onPanelMouseUp=function(A){this.startMoving=false;EUI.disableDocTextSelect(this.basedom,true);$(this.doc.body).unbind("mousemove.erich mouseup.erich mouseleave.erich");};t.prototype._onColorsPanelMouseDown=function(A){var D=A.target,C=this.options;if(EUI.hasClassName(D,"eui-color-item")){var B=D.style.backgroundColor;this.changeType="panel";this.setTotalColor(B);this.setRangeOpacity(1);}else{if(EUI.hasClassName(D,"eui-icon")){this.switchColorPanel(!C.isHidden,true);}}};t.prototype.onTransParentClick=function(){this.setEditValue("transparent");this.setRangeOpacity(0);this._doApply("apply");};t.prototype.addSelectColorItem=function(D){if(D=="transparent"||!D){return;}var B=this.options,A=B.selectColorDom,I=A.childNodes,H=I.length;if(!B.selectColors){B.selectColors=[];}var G=B.selectColors.indexOf(D);if(G!=-1){if(G==0){return;}var E=I[G+1];A.removeChild(I[G+1]);A.insertBefore(E,I[1]);B.selectColors.removeAt(G);B.selectColors.unshift(D);}else{var F=this.doc.createElement("li");F.className="eui-color-item";B.selectColors.unshift(D);D=D.charAt(0)=="#"?j.HEX2RGB(D):D;var J=j.RGB2ARR(D);J[0]=Math.max(0,parseInt(J[0],10)-20);var C="rgb("+J[0]+","+J[1]+","+J[2]+")";F.style.cssText+=";background-color:"+D+";border-color:"+C+";";if(H>=11){A.removeChild(I[10]);A.insertBefore(F,I[1]);}else{if(H==0){A.appendChild(F);}else{A.insertBefore(F,I[1]);}}}};t.prototype.setColorByPoint=function(A,F){var D=A-this.mainColorRect.left,C=F-this.mainColorRect.top;D=Math.min(Math.max(D,0),this.mainColorWidth);C=Math.min(Math.max(C,0),this.mainColorHeight);this.options.choosePointer.style.cssText+=";left:"+D+"px;top:"+C+"px;";var B=this.rangeColor.getValue(),E=j.HSB2RGB(B,D/this.mainColorWidth*100,100-C/this.mainColorHeight*100);this._currentColor="rgb("+E[0]+","+E[1]+","+E[2]+")";this.setShowColor(this._currentColor);this.setOpacityRangeColor(this._currentColor);this.setEditValue(this._currentColor);this.setRangeOpacity(1);};t.prototype.onEditValueChange=function(A){var D=this.getEditValue(),C=this.options;C.edit.value=D;this.changeType="input";if(this.ensureColor(D)==true){this.setShowColor(D);this.setOpacityRangeColor(D);this.setRangeOpacity(1);var B=j.RGB2HSB(this.rgbColor);this.rangeColor.setValue(B[0],false);this.setPointBycolor(D);var E=this.hsbToRgb(B[0]);D="rgb("+E[0]+","+E[1]+","+E[2]+")";this.setMainColor(D);}};t.prototype.setPointBycolor=function(A){A=A.charAt(0)=="#"?j.HEX2RGB(A):A;var B=j.RGB2HSB(A),D=B[1]/100*this.mainColorWidth,C=this.mainColorHeight-(B[2]/100*this.mainColorHeight);this.options.choosePointer.style.cssText+=";left:"+D+"px;top:"+C+"px;";};t.prototype.onChangeColor=function(G){var A=this.options;if(A.edit.value=="transparent"||A.showColor.style.opacity=="unset"){this.setRangeOpacity(1);}var H=A.choosePointer,C=H.offsetLeft,F=H.offsetTop;var I=this.hsbToRgb(G,C/this.mainColorWidth*100,100-F/this.mainColorHeight*100);var B=this.hsbToRgb(G);var D="rgb("+B[0]+","+B[1]+","+B[2]+")",E="rgb("+I[0]+","+I[1]+","+I[2]+")";this._currentColor=D;this.setMainColor(D);this.setShowColor(E);this.setOpacityRangeColor(E);this.setEditValue(D);};t.prototype.onChangeOpacity=function(A){this.setShowOpacity(A);};t.prototype.setMainColor=function(A){this.options.mainColor.style.cssText+=";background-color:"+A+";";};t.prototype.setShowColor=function(C,D){var A=this.options.showColor,B=A.style;if(D=="transparent"){B.cssText+=";background-color:transparent;border:none;";}else{B.cssText+=";background-color:"+C+";";if(B.border==="none"){B.border="";}this.setShowDorder(C);}};t.prototype.setShowDorder=function(A){A=A.charAt(0)=="#"?j.HEX2RGB(A):A;var C=j.RGB2ARR(A);C[0]=Math.max(0,parseInt(C[0],10)-20);var B="rgb("+C[0]+","+C[1]+","+C[2]+")";this.options.showColor.style.cssText+=";border-color:"+B+";";};t.prototype.setOpacityRangeColor=function(A){A=A.charAt(0)=="#"?j.HEX2RGB(A):A;this.rgbColor=A;if(!A){return;}var B=j.RGB2ARR(A);this.options.rangeOpacityDom.firstChild.firstChild.style.cssText+=";background:linear-gradient(to right,rgba("+B[0]+","+B[1]+","+B[2]+",0),rgba("+B[0]+","+B[1]+","+B[2]+",1));";};t.prototype.setShowOpacity=function(C){var D=this.options,A=D.showColor,E=D.edit.value;var B=A.style;B.cssText+=";opacity:"+C+";";if(C==0||E=="transparent"){B.cssText+=";opacity:unset;background-color:transparent;border:none;background-image:url("+EUI.xuiimg("picker/shadow.png")+")";}else{B.cssText+=";background-image:none;background-color:"+E+";";if(B.border==="none"){B.border="";}this.setShowDorder(E);}};t.prototype.setEditValue=function(C,B,A){if(!B&&B!="transparent"){if(C!="transparent"&&C){C=C.charAt(0)=="#"?C:j.RGB2HEX(C);}}else{C=B;}this.options.edit.value=A?"":C;};t.prototype.getEditValue=function(){return this.options.edit.value;};t.prototype.setPanelColors=function(A){return this.commonColors=A;};t.prototype.setCommonColorVisiable=function(A){A=EUI.parseBool(A,true);this.options.colorCommonDom.style.display=A?"":"none";};t.prototype.setSelectColorVisiable=function(A){A=EUI.parseBool(A,true);this.options.selectColorDom.style.display=A?"":"none";};t.prototype.setOpacityVisiable=function(A){A=EUI.parseBool(A,true);this.options.rangeOpacityDom.style.display=A?"":"none";};t.prototype.setButtonVisiable=function(D,A){A=EUI.parseBool(A,false);var C=this.options,B;if(D=="ok"){B=C.okButton;}else{if(D=="apply"){B=C.applyButton;}else{if(D=="cancel"){B=C.cancelButton;}else{if(D=="all"){B=C.colorFooter;}}}}if(A){EUI.removeClassName(B,"eui-hide");}else{EUI.addClassName(B,"eui-hide");}};t.prototype.hsbToRgb=function(C,B,A){C=parseInt(C,10);if(!EUI.isNumber(C)){return;}B=B||100;A=A||100;return j.HSB2RGB(C,B,A);};var j={HEX2RGB:function(C){var B,A,D;C=""+C;if(typeof C!=="string"){return;}if(C.charAt(0)=="#"){C=C.substring(1);}if(C.length==3){C=C[0]+C[0]+C[1]+C[1]+C[2]+C[2];}if(/^[0-9a-fA-F]{6}$/.test(C)){B=parseInt(C.substr(0,2),16);A=parseInt(C.substr(2,2),16);D=parseInt(C.substr(4,2),16);return"rgb("+B+","+A+","+D+")";}},RGB2HEX:function(A){var B=this.RGB2ARR(A);if(!B||B.length!==3){return;}var C="#"+((1<<24)+(parseInt(B[0])<<16)+(parseInt(B[1])<<8)+parseInt(B[2])).toString(16).slice(1);return C;},RGB2ARR:function(B){var F=/[0-9]{1,3}/g;var C=B.match(F)||[];var E=C[0],D=C[1],A=C[2];if(E>=0&&E<=255&&D>=0&&D<=255&&A>=0&&A<=255){return[E,D,A];}},RGB2HSB:function(C){if(!C){return;}C=this.RGB2ARR(C);if(C.length!==3){return;}var B={h:0,s:0,b:0};var D=Math.min(C[0],C[1],C[2]);var A=Math.max(C[0],C[1],C[2]);var E=A-D;B.b=A;B.s=A!=0?255*E/A:0;if(B.s!=0){if(C[0]==A){B.h=(C[1]-C[2])/E;}else{if(C[1]==A){B.h=2+(C[2]-C[0])/E;}else{B.h=4+(C[0]-C[1])/E;}}}else{B.h=-1;}if(A==D){B.h=0;}B.h*=60;if(B.h<0){B.h+=360;}B.s*=100/255;B.b*=100/255;return[B.h,B.s,B.b];},HSB2RGB:function(F,E,A){var B={};E=E*255/100;A=A*255/100;if(E==0){B.r=B.g=B.b=A;}else{var G=A;var D=(255-E)*A/255;var C=(G-D)*(F%60)/60;if(F==360){F=0;}if(F<60){B.r=G;B.b=D;B.g=D+C;}else{if(F<120){B.g=G;B.b=D;B.r=G-C;}else{if(F<180){B.g=G;B.r=D;B.b=D+C;}else{if(F<240){B.b=G;B.r=D;B.g=G-C;}else{if(F<300){B.b=G;B.g=D;B.r=D+C;}else{if(F<360){B.r=G;B.g=D;B.b=G-C;}else{B.r=0;B.g=0;B.b=0;}}}}}}}return[Math.round(B.r),Math.round(B.g),Math.round(B.b)];}};return{EColorPanel:z,EColorListPanel:l,ECustomColorPanel:o,ERichColorPanel:t};});