define(["eui/modules/uibase","eui/modules/ecolorpanel"],function(uibase,ecolorpanel){var parseBool=EUI.parseBool;var EComponent=uibase.EComponent;var EColorPanel=ecolorpanel.EColorPanel;function EPopupMenu(options){options=options||{};EComponent.call(this,options);this._items=[];this._visible=false;this.hasAddEvent=false;this.checkHr=options.checkHr;this.isvert=EUI.parseBool(options.isvert,false);this._initEPopupMenu(options);this.setOnClickItem(options.onclickitem);}EUI.extendClass(EPopupMenu,EComponent,"EPopupMenu");EPopupMenu.CONFIG={img:{checked:"&#xef16;",rightArrow:"&#xef81;",blank:""}};EPopupMenu.DEFAULT_ID_PREFIX="ESEN$EPopupMenu";EPopupMenu.prototype._initEPopupMenu=function(options){var clsname=(options&&options.baseCss)?("eui-menu-container "+options.baseCss):"eui-menu-container";if(this.isvert){clsname+=" eui-menu-vert";}clsname+=" eui-panel-hide";var $container=$('<div class="'+clsname+'"><ul class="eui-menu-group"></ul></div>').appendTo(this.parentElement);var container=this.container=$container[0];this.basedom=container;container.id=EUI.idRandom(EPopupMenu.DEFAULT_ID_PREFIX);container.oncontextmenu=EUI.returnfalse;this.scrollcontainer=container.firstChild;this._upArrow=null;this._downArrow=null;container._sancomponent=this;};EPopupMenu.prototype.dispose=function(){if(this.doc&&this.hasAddEvent){EUI.attacheEvent4TopIframes("remove","mousedown",this._mouseDownListener);this._mouseDownListener=null;}if(this._XColorPicker){this._XColorPicker.dispose();this._XColorPicker=null;}if(this._items){while(this._items.length>0){this._items.pop().dispose();}this._items=null;}if(this._visibleItems){while(this._visibleItems.length>0){this._visibleItems.pop().dispose();}this._visibleItems=null;}if(this._rowheight){this._rowheight=null;this._updownarrowvisible=null;this._arrowheight=null;this._maxscrollTop=null;EUI.removeEvent(this.scrollcontainer,"mousewheel",this._mouseWheelBind);this._mouseWheelBind=null;this.scrollcontainer=null;}if(this.container){this.container.oncontextmenu=null;this.container.onselectstart=null;this.container=null;}this.__userdata=null;this.__checkGroups=null;this._parent=null;this._currentEMenuItem=null;this._currentEPopupMenu=null;this._currentToolButton=null;this._parentActiveEMenuItem=null;this.onclickitem=null;this.onpopup=null;this.onhidden=null;this._toolbar=null;this._initColorPicker2EPopupMenuBind=null;this._adjustBackgroundIframeBind=null;this.onfinished=null;this.onfinishedUserdata=null;this._upArrow=null;this._downArrow=null;this._popuppos=null;EComponent.prototype.dispose.call(this);};EPopupMenu.prototype.addBaseCss=function(baseCss){var items=this._items;for(var i=0,len=items.length;i<len;i++){var item=items[i];if(item.__popupmenu){var basedom=item.__popupmenu.getBaseDom();if(basedom){EUI.addClassName(basedom,baseCss);}}}EPopupMenu._superClass.prototype.addBaseCss.call(this,baseCss);};EPopupMenu.prototype.addEMenuItem=function(caption,icon,onclick,oninit,desc){if(caption=="-"){return this.addHr();}var rs=new EMenuItem(this,caption);if(icon){rs.setIcon(icon);}if(onclick){rs.setOnClick(onclick);}this.adjustBackgroundIframe();if(oninit&&typeof(oninit)=="function"){rs.setOnInit(oninit);oninit(rs);}if(desc){rs.setDesc(desc);}this._items.push(rs);return rs;};EPopupMenu.prototype.addMenuItem=EPopupMenu.prototype.addEMenuItem;EPopupMenu.prototype.addHr=function(){var r=this.scrollcontainer;return $('<li class="eui-menu-line"></li>').appendTo(r)[0];};EPopupMenu.prototype.removeHr=function(p){if("eui-menu-line".equalsIgnoreCase(p.className)){$(p).remove();}};EPopupMenu.prototype._callEvent=function(func,p){if(!func){return false;}if(EUI.isString(func)){if(func.length>4&&func.lastIndexOf("(")!=-1){new Function("menu","p",func)(p.owner||p,p);return true;}else{var names=func.split(".");func=window;for(var i=0,len=names.length;i<len;i++){if(!(func=func[names[i]])){return false;}}func(p);return true;}}if(EUI.isFunction(func)){func(p);return true;}return false;};EPopupMenu.prototype.setParent=function(p){this._parent=p;};EPopupMenu.prototype.getParent=function(){return this._parent;};EPopupMenu.prototype.clearHighlight=function(){for(var i=0,n=this.getEMenuItemCount();i<n;i++){this.getEMenuItem(i).highlightEMenuItem(false);}};EPopupMenu.prototype.getCurrentToolButton=function(){return this._currentToolButton;};EPopupMenu.prototype.setCurrentToolButton=function(p){this._currentToolButton=p;};EPopupMenu.prototype.setOnPopup=function(et){this.onpopup=et;};EPopupMenu.prototype.getContainer=function(){return this.container;};EPopupMenu.prototype.getBaseDom=EPopupMenu.prototype.getContainer;EPopupMenu.prototype.getContent=function(){return this.scrollcontainer;};EPopupMenu.prototype.getEMenuItemCount=function(){var items=this._items,count=items.length;if(arguments[0]===true){for(var i=0,len=count;i<len;i++){if(!items[i].isVisible()){count-=1;}}}return count;};EPopupMenu.prototype.getMenuItemCount=EPopupMenu.prototype.getEMenuItemCount;EPopupMenu.prototype.getEMenuItem=function(iorname){if(!this._items){return null;}if(iorname&&typeof(iorname)=="string"){if(isNaN(iorname)){var tmp,rs;for(var i=0,cnt=this._items.length;i<cnt;i++){tmp=this._items[i];if(tmp.name==iorname){rs=tmp;break;}if(tmp.__popupmenu){rs=tmp.getEMenuItem(iorname);if(rs){break;}}}return rs;}iorname=parseInt(iorname,10);}if(typeof(iorname)=="number"&&iorname<this._items.length){return this._items[iorname];}return null;};EPopupMenu.prototype.getMenuItem=EPopupMenu.prototype.getEMenuItem;EPopupMenu.prototype.getItems=function(){var items=[],self=this,tmp;var count=function(menu){items=items.concat(menu._items);for(var i=0;i<menu._items.length;i++){tmp=menu._items[i];if(tmp.__popupmenu){count(tmp.__popupmenu);}}};count(self);return items;};EPopupMenu.prototype.getMenuItemByCaption=function(caption){if(!this._items){return null;}for(var i=0,cnt=this._items.length;i<cnt;i++){var tmp=this._items[i];if(tmp.getCaption()==caption){return tmp;}}return null;};EPopupMenu.prototype.findEMenuItem=function(id){var isstr=typeof(id)=="string";var isobj=typeof(id)=="object";var tmp;for(var i=0,cnt=this.getEMenuItemCount();i<cnt;i++){tmp=this.getEMenuItem(i);tmp.index=i;if(isstr){if(tmp.getId()==id){return tmp;}}else{if(isobj){if(tmp==id){return tmp;}}else{break;}}}return null;};EPopupMenu.prototype.findMenuItem=EPopupMenu.prototype.findEMenuItem;EPopupMenu.prototype.removeEMenuItem=function(id){var result=this.findEMenuItem(id);if(!result){return false;}$(result.getContainer()).remove();this.adjustBackgroundIframe();this._items.splice(result.index,1);result.dispose();return true;};EPopupMenu.prototype.removeMenuItem=EPopupMenu.prototype.removeEMenuItem;EPopupMenu.prototype.adjustBackgroundIframe=function(){if(!EUI.browser.isie){return;}if(!this._visible){return;}var container=this.getContainer();var rs=EUI.showBackGroundIFrame(this.getContainer(),true);container.style.display="none";container.getBoundingClientRect();container.style.display="";};EPopupMenu.prototype._addEventListener=function(){if(this.hasAddEvent){return;}if(!this._mouseDownListener){this._mouseDownListener=this._mouseDownEvent.bind(this);}EUI.attacheEvent4TopIframes("add","mousedown",this._mouseDownListener);this.hasAddEvent=true;};EPopupMenu.prototype._mouseDownEvent=function(e){var gme=EUI._getMouseEventEComponent(e,EPopupMenu);if(!gme){this.hidden();}};EPopupMenu.prototype.__popup_checkHr=function(){var m=this.getContent();var row;var rs;var ishr=false;var items=m.getElementsByTagName("li");for(var i=0,cnt=items.length;i<cnt;i++){row=items[i];ishr=row._sancomponent==null;if(!ishr&&row.style.display=="none"){continue;}if(!rs){rs=[];}rs.push(row);}if(!rs||rs.length==0){return;}var tmp,tmp2;var count=rs.length;var ishr=false;for(var i=0;i<count;i++){tmp=rs[i];ishr=tmp._sancomponent==null;if(ishr&&tmp.style.display=="none"){tmp.style.display="";}if(ishr&&(i==0||i==count-1)){tmp.style.display="none";continue;}if(i<count){tmp2=rs[i+1];}if(ishr&&tmp2&&tmp2._sancomponent==null){tmp.style.display="none";}}};EPopupMenu.prototype._scrollMenu=function(offset){var scrollContainer=this.scrollcontainer,oriScrollTop=scrollContainer.scrollTop;scrollContainer.scrollTop=!offset?0:(oriScrollTop+offset*this._rowheight);var scrollTop=scrollContainer.scrollTop;if(scrollTop===oriScrollTop){return;}if(scrollTop===0){this._upArrow.className="eui-menu-uparrow eui-disabled";}else{if(oriScrollTop===0){this._upArrow.className="eui-menu-uparrow";}}if(scrollTop===this._maxscrollTop){this._downArrow.className="eui-menu-downarrow eui-disabled";}else{if(oriScrollTop===this._maxscrollTop){this._downArrow.className="eui-menu-downarrow";}}};EPopupMenu.prototype._mouseWheel=function(e){this._scrollMenu(e.wheelDelta);};EPopupMenu.prototype.popup=function(x,y){if(this.getEMenuItemCount(true)==0){return;}if(!!this._visible){this.hidden();}this._callEvent(this.onpopup,this);this._popuppos=[].slice.apply(arguments);var container=this.getContainer(),content=this.getContent(),_body=this.doc.body;if(this._updownarrowvisible){content.style.height="";}var width=container.offsetWidth,maxX=_body.scrollLeft+_body.clientWidth-width-2;if(x>maxX){x=Math.max(arguments[2]?arguments[2]-width:maxX,2);}var bch=_body.clientHeight-10,height=container.offsetHeight;if(bch<height){if(!this._updownarrowvisible){var upArrow=this._upArrow,downArrow=this._downArrow;if(!upArrow){upArrow=this._upArrow=$('<div class="eui-menu-uparrow"></div>').prependTo(container)[0];downArrow=this._downArrow=$('<div class="eui-menu-downarrow"></div>').appendTo(container)[0];}this._updownarrowvisible=true;upArrow.parentNode.style.display="";downArrow.parentNode.style.display="";if(!this._rowheight){upArrow.onclick=this._scrollMenu.bind(this,-1);downArrow.onclick=this._scrollMenu.bind(this,1);var _rh=26,item=this._items[0];if(item){_rh=parseInt(EUI.getCurrentStyle(item.getContainer(),"height"))||26;}this._rowheight=_rh;this._arrowheight=upArrow.offsetHeight+downArrow.offsetHeight;this._mouseWheelBind=this._mouseWheel.bind(this);EUI.addEvent(content,"mousewheel",this._mouseWheelBind);}}bch=bch-this._arrowheight,y=bch%this._rowheight,bch=bch-y;this._maxscrollTop=content.clientHeight-bch;content.style.height=bch+"px";y=y/2+5;this._scrollMenu(0);}else{var maxY=_body.scrollTop+bch-height+2;if(y>maxY){y=Math.max(arguments[3]?arguments[3]-height:maxY,2);}if(this._updownarrowvisible){this._updownarrowvisible=false;this._upArrow.style.display="none";this._downArrow.style.display="none";EUI.removeEvent(content,"mousewheel",this._mouseWheelBind);}}container.style.cssText+="; left: "+x+"px; top: "+y+"px;";if(this.getRootEPopupMenu().checkHr){this.__popup_checkHr();}this.show();this._addEventListener();};EPopupMenu.prototype.isVisible=function(){return this._visible;};EPopupMenu.prototype.popupAtCursor=function(e){var pi=EUI.getCursorPosition(e,this.wnd);this.popupAtPosition(pi.x,pi.y);};EPopupMenu.prototype.popupAtPosition=function(x,y){this.popup(x,y,arguments[2],arguments[3]||y);};EPopupMenu.prototype.popupDownAt=function(id){if(!id){return false;}var obj=typeof(id)==="string"?this.doc.getElementById(id):(id.getBoundingClientRect?id:null);if(!obj){return false;}var rect=obj.getBoundingClientRect();if(EUI.browser.isie&&rect.bottom===0){rect=obj.getBoundingClientRect();}this.popup(rect.left,rect.bottom,null,rect.top);return true;};EPopupMenu.prototype.popupRightAt=function(id){if(!id){return false;}var obj=typeof(id)==="string"?this.doc.getElementById(id):(id.getBoundingClientRect?id:null);if(!obj){return false;}var rect=obj.getBoundingClientRect();if(EUI.browser.isie&&rect.bottom===0){rect=obj.getBoundingClientRect();}this.popup(rect.right,rect.top,rect.left,rect.bottom);return true;};EPopupMenu.prototype.clear=function(){if(this._items){var items=this._items,arg=arguments[0];while(items.length>0){items.pop().dispose(arg);}}var r=this.getContent();r.innerHTML="";};EPopupMenu.prototype.setOnHidden=function(func){this.onhidden=func;};EPopupMenu.prototype.hidden=function(){if(!this._visible){return;}this._visible=false;this._popuppos=null;this.mgrLayer();var container=this.getContainer();container.style.zIndex="";EUI.addClassName(container,"eui-panel-hide");EUI.showBackGroundIFrame(container,false);var paitem=this.getParentActiveEMenuItem();if(paitem&&this.isvert){EUI.addClassName(paitem.subcontainerdom,"eui-hide");EUI.removeClassName(paitem._arrowimg,"eui-menu-expanded");}if(this.hasAddEvent){EUI.attacheEvent4TopIframes("remove","mousedown",this._mouseDownListener);this.hasAddEvent=false;}var ctb=this.getCurrentToolButton();if(ctb){ctb.highlightToolButton(false);ctb.highlightToolButtonArrow(false);}this.setCurrentToolButton(null);var cmi=this.getCurrentEMenuItem();if(cmi){cmi.highlightEMenuItem(false);}this.setCurrentEMenuItem(null);var tmp;for(var i=0,n=this.getEMenuItemCount();i<n;i++){tmp=this.getEMenuItem(i);if(tmp.getEMenuItemCount()>0){tmp._hidden();}}this._callEvent(this.onhidden,this);};EPopupMenu.prototype.show=function(){this._visible=true;var container=this.getContainer();this.mgrLayer("show");EUI.removeClassName(container,"eui-panel-hide");if(!container.style.zIndex){var pmenu=this.getParent();if(pmenu){var pzindex=parseInt(EUI.getCurrentStyle(pmenu.getContainer(),"z-index"),10)||99999;container.style.zIndex=(pmenu.getContainer().style.zIndex||9)+1;}}if(this.isvert){this.popupAllMenuInVert();}this.adjustBackgroundIframe();};EPopupMenu.prototype.setVisible=function(f){f||false?this.show():this.hidden();};EPopupMenu.prototype.setToolbar=function(t){this._toolbar=t;};EPopupMenu.prototype.getToolbar=function(){return this._toolbar;};EPopupMenu.prototype.setToolButton=function(t){this._toolbutton=t;};EPopupMenu.prototype.getToolButton=function(){return this._toolbutton;};EPopupMenu.prototype.showEPopupMenu=function(p,e){var tmp=p.__popupmenu,owner=p.getOwner();if(tmp){this._callEvent(p.onpopupmenu,p);if(!owner.isvert){tmp.popupRightAt(p.getContainer());}else{EUI.removeClassName(p.subcontainerdom,"eui-hide");EUI.addClassName(p._arrowimg,"eui-menu-expanded");tmp.show();}this.setCurrentEPopupMenu(tmp);return true;}return false;};EPopupMenu.prototype.popupAllMenuInVert=function(){if(!this.isvert){return;}var items=this._items;for(var i=0,len=items.length;i<len;i++){var item=items[i];if(!item){continue;}var menu=item.getPopupmenu();if(!menu){continue;}EUI.removeClassName(item.subcontainerdom,"eui-hide");EUI.addClassName(item._arrowimg,"eui-menu-expanded");menu.show();}};EPopupMenu.prototype.setParentActiveEMenuItem=function(p){this._parentActiveEMenuItem=p;};EPopupMenu.prototype.setParentActiveMenuItem=EPopupMenu.prototype.setParentActiveEMenuItem;EPopupMenu.prototype.getParentActiveEMenuItem=function(){return this._parentActiveEMenuItem;};EPopupMenu.prototype.getParentActiveMenuItem=EPopupMenu.prototype.getParentActiveEMenuItem;EPopupMenu.prototype.setCurrentEMenuItem=function(p){this._currentEMenuItem=p;};EPopupMenu.prototype.setCurrentMenuItem=EPopupMenu.prototype.setCurrentEMenuItem;EPopupMenu.prototype.getCurrentEMenuItem=function(){return this._currentEMenuItem;};EPopupMenu.prototype.getCurrentMenuItem=EPopupMenu.prototype.getCurrentEMenuItem;EPopupMenu.prototype.setCurrentEPopupMenu=function(p){this._currentEPopupMenu=p;};EPopupMenu.prototype.getCurrentEPopupMenu=function(){return this._currentEPopupMenu;};EPopupMenu.prototype.getId=function(){return this.container.id;};EPopupMenu.prototype.getRootEPopupMenu=function(){var r=this;while(r._parent){r=r._parent;}return r;};EPopupMenu.prototype.setOnClickItem=function(p){this.onclickitem=p;};EPopupMenu.prototype.processCheckGroup=function(groupname,name){var rs=this.__checkGroups["chkGrp_"+groupname];if(!rs||rs.length<=0){return;}var tmp;var haschecked=false;for(var i=0,n=rs.length;i<n;i++){tmp=rs[i];if(tmp.getName()===name){tmp.setChecked(true);haschecked=true;}else{tmp.setChecked(false);}}if(groupname.charAt(0)=="$"&&haschecked===false){rs[0].setChecked(true);}};EPopupMenu.prototype.loadMenus=function(p,onfinished,userdata){if(!p){return;}this.onfinished=onfinished;this.onfinishedUserdata=userdata;if(p&&typeof(p)=="string"){EUI.parseXML(p,_EPopupMenu$LoadMenus$ParseXMLCallback,this);return;}if(p.nodeType===1){var jsurl=p.getAttribute("jsurl");if(jsurl){EUI.addScripts(this.doc,jsurl);}}_EPopupMenu$LoadMenus$XmlNode2EMenuItem(p.documentElement?p.documentElement:p,this);if(typeof(this.onfinished)=="function"){this.wnd.setTimeout(this.onfinished.bind(this,this,this.onfinishedUserdata),0);}};function _EPopupMenu$LoadMenus$ParseXMLCallback(p,popupmenu){popupmenu.loadMenus(p,popupmenu.onfinished,popupmenu.onfinishedUserdata);}function _EPopupMenu$LoadMenus$XmlNode2EMenuItem(rs,popupmenu){if(!rs){return;}var attrs,attr,tmp,caption,_popup;for(var i=0,n=rs.childNodes.length;i<n;i++){tmp=rs.childNodes[i];if(tmp.nodeType!=1){continue;}caption=tmp.getAttribute("caption");if(!caption){continue;}if(caption=="-"){popupmenu.addHr();continue;}var oninit=tmp.getAttribute("oninit");if(oninit&&typeof(oninit)=="string"){oninit=eval(oninit);}_popup=popupmenu.addEMenuItem(caption,"","",oninit);_popup.setOnInit(oninit);attrs=tmp.attributes;var pnm,pvalue;for(var j=0,len=attrs.length;j<len;j++){attr=attrs.item(j);pnm=attr.name;pvalue=attr.value;switch(pnm){case"caption":break;case"name":_popup.name2=pvalue;case"id":_popup.setName(pvalue);break;case"onclick":case"cmd":_popup.setOnClick(pvalue);break;case"icon":case"img":_popup.setIcon(pvalue);break;case"menus":var _popupmenus=eval(pvalue);_popup.addMenus(_popupmenus);_popupmenus.popupDownAt(_popup.owner.getContent());break;case"checkgroup":_popup.setCheckGroup(pvalue);break;case"checkedkicon":case"checkedimg":_popup.setCheckedIcon(pvalue);break;case"checked":_popup.setChecked(parseBool(pvalue,false));break;case"enabled":_popup.setEnabled(parseBool(pvalue,true));break;case"browser":var _browser=pvalue.toLowerCase();if(_browser){_popup.setEnabled(new RegExp(_browser,"g").test(userAgent.toLowerCase()));}case"visible":_popup.setVisible(parseBool(pvalue,true));break;case"stl":_popup.setCss(pvalue);break;default:if(!_popup[pnm]){_popup[pnm]=pvalue;}}}if(tmp.childNodes.length>0){_EPopupMenu$LoadMenus$XmlNode2EMenuItem(tmp,_popup);}}}function EMenuItem(owner,caption,nm){this.owner=owner;this._caption=caption?caption:"";this._checked=false;this._hasArrow=false;this._visible=true;this._initEMenuItem(nm);}EMenuItem.DEFAULT_ID_PREFIX="ESEN$EMenuItem";EMenuItem.DEFAULT_HEIGHT=20;EMenuItem.DEFAULT_DELAY=300;EMenuItem.prototype.dispose=function(){if(this.__popupmenu){if(arguments[0]!==true){this.__popupmenu.dispose();}this.__popupmenu=null;}if(this._itemrow){this._itemrow.oncontextmenu=null;this._itemrow.onmouseover=null;this._itemrow.onmouseout=null;this._itemrow.onclick=null;this._itemrow._sancomponent=null;this._itemrow=null;}this.__userdata=null;this._captionNode=null;this.onclick=null;this.onpopupmenu=null;this.oncontextmenu=null;this.onmouseover=null;this.owner=null;};EMenuItem.prototype.isMenuItem=true;EMenuItem.prototype.getName=function(){return this.name;};EMenuItem.prototype.setName=function(nm){if(!this._itemrow){return;}this.name=nm&&typeof(nm)=="string"?nm:EUI.getUniqueHtmlId("EMenuItem",EMenuItem.DEFAULT_ID_PREFIX);this._itemrow.id=this.name.ensureStartWith(EMenuItem.DEFAULT_ID_PREFIX);};EMenuItem.prototype.getUserObj=function(){return this.userObj;};EMenuItem.prototype.setUserObj=function(userObj){this.userObj=userObj;};EMenuItem.prototype._initEMenuItem=function(nm){var content=this.owner.getContent();this._itemrow=$('<li class="eui-menu-item"><div><i class="eui-icon"></i><span>'+this._caption+'</span><span class="eui-menu-desc eui-hide"></span><i class="eui-icon eui-menu-more" style="visibility:hidden;"></i></div><div class="eui-menu-sub-group eui-hide"></div></li>').appendTo(content)[0];this.setName(nm);this._itemrow.isHighlight=false;this._itemrow.isInsertDOM=false;this._itemrow.UNSELECTABLE="on";this.contentdom=this._itemrow.firstChild;this.subcontainerdom=this._itemrow.lastChild;this._iconNode=this.contentdom.firstChild;this._captionNode=this._iconNode.nextSibling;this._captionNode.UNSELECTABLE="on";this.setCaption(this._caption);this._descNode=this._captionNode.nextSibling;this._arrowimg=this._descNode.nextSibling;this._arrowimg.isrow=true;this._arrowimg.id=this._itemrow.id+".arrow";this._itemrow.onmouseover=_EMenuItem$OnMouseOverEvent;this._itemrow.onmouseout=_EMenuItem$OnMouseOutEvent;this._itemrow.onclick=_EMenuItem$OnClickEvent;this._itemrow.oncontextmenu=_EMenuItem$OnContextMenuEvent;this._itemrow._sancomponent=this;};EMenuItem.prototype.clearTimer=function(){if(this.timerid>0){this.owner.wnd.clearTimeout(this.timerid);}this.timerid=0;};EMenuItem.prototype._hidden=function(f){f=f||false;var tmp;var pmi;for(var i=0,n=this.getEMenuItemCount();i<n;i++){this.__popupmenu.hidden();if(f){pmi=this.__popupmenu.getParentActiveEMenuItem();if(pmi){pmi.highlightEMenuItem(false);}}tmp=this.getEMenuItem(i);if(tmp.getEMenuItemCount()>0){tmp._hidden(f);}}};function _EMenuItem$OnMouseOverEvent(e,self){e.stopPropagation?e.stopPropagation():(e.cancelBubble=true);if(!self){self=this._sancomponent;}if(!self){return;}if(!self.isEnabled()){return false;}self.getOwner()._callEvent(self.onmouseover,self);var spopupmenu=self.getOwner();var ctb=spopupmenu.getCurrentToolButton();if(ctb){ctb.highlightToolButton();}var pmi=spopupmenu.getParentActiveEMenuItem();var isvert=self.getOwner().isvert;if(isvert){return;}if(pmi){pmi.highlightEMenuItem(true);pmi.getOwner().setCurrentEMenuItem(pmi);}var cmi=spopupmenu.getCurrentEMenuItem();if(cmi&&cmi!=self){cmi._hidden(true);self._hidden(true);}self.clearTimer();self._timeoutShowEPopupMenu();self.highlightEMenuItem(true);return !this.isInsertDOM;}function _EMenuItem$OnMouseOutEvent(e,self){if(!self){self=this._sancomponent;}if(!self){return;}if(!self.isEnabled()){return false;}if(this.isInsertDOM){return false;}self.getOwner().setCurrentEMenuItem(self);self.clearTimer();self.highlightEMenuItem(false);return true;}function _EMenuItem$OnContextMenuEvent(e,self){if(!self){self=this._sancomponent;}if(!self){return;}if(!e){e=self.owner.wnd.event;}if(typeof(self.oncontextmenu)=="function"){self.oncontextmenu(e,self);}return false;}function _EMenuItem$OnClickEvent(e,self){if(!self){self=this._sancomponent;}if(!self){return;}var object=this;if(!self.isEnabled()){return false;}if(object.isInsertDOM){return false;}if(self.hasChecked){self.setChecked(!self.isChecked());}self._processCheckGroup();var spopupmenu=self.getOwner();var isvert=spopupmenu.isvert;var r=false;var cmi=spopupmenu.getCurrentEMenuItem();if(isvert){if(self.isChildMenuVisible()){self.clearTimer();self.hidden();return;}}else{if(cmi){cmi._hidden();}}self._hidden();self.clearTimer();if(self.isChildMenuVisible()){if(!isvert){return false;}self.hidden();}r=spopupmenu.showEPopupMenu(self);if(!r&&!self.hasChildEMenuItem()){var root=self.getRootEPopupMenu();var tb=root.getToolButton();if(tb){tb.hidden();}else{root.hidden();}}spopupmenu._callEvent(self.onclick,self);if(self.owner){spopupmenu._callEvent(self.owner.onclickitem,self);}spopupmenu.showEPopupMenu(self);return true;}EMenuItem.prototype.getRootEPopupMenu=function(){return this.owner.getRootEPopupMenu();};EMenuItem.prototype.highlightEMenuItem=function(f){if(!this._itemrow){return;}if(typeof(f)!="boolean"){f=false;}if(this._itemrow.isHighlight==f){return;}this._itemrow.isHighlight=f;if(f){$(this._itemrow).addClass("eui-menu-item-active");}else{$(this._itemrow).removeClass("eui-menu-item-active");}};EMenuItem.prototype._timeoutShowEPopupMenu=function(){if(!this.hasChildEMenuItem()){return;}if(this.isChildMenuVisible()){return;}this.timerid=this.owner.wnd.setTimeout(this._timeoutShowEPopupMenuCallback.bind(this),EMenuItem.DEFAULT_DELAY);};EMenuItem.prototype._timeoutShowEPopupMenuCallback=function(){this.clearTimer();var owner=this.getOwner();owner.showEPopupMenu(this);};EMenuItem.prototype.getContainer=function(){return this._itemrow;};EMenuItem.prototype.setVisible=function(f){if(this._visible===(f=(f===true?true:false))){return;}this.getContainer().style.display=(this._visible=f)?"":"none";this.getOwner().adjustBackgroundIframe();};EMenuItem.prototype.isVisible=function(){return this._visible;};EMenuItem.prototype.setCaption=function(caption){this._caption=caption?caption:"";this._captionNode.innerHTML=this._caption;this._itemrow.title=this._caption;};EMenuItem.prototype.getCaption=function(){return this._caption;};EMenuItem.prototype.setIcon=function(p){this.icon=p;EUI.setTagIcon(this._iconNode,p);this.setIconVisible(!!p);};EMenuItem.prototype.getIcon=function(){return this.icon;};EMenuItem.prototype.setIconVisible=function(isvisible){isvisible=EUI.parseBool(isvisible,false);this._iconNode.style.visibility=isvisible?"visible":"hidden";};EMenuItem.prototype.setDesc=function(desc){if(!desc){return;}EUI.removeClassName(this._descNode,"eui-hide");this._descNode.innerText=desc;};EMenuItem.prototype.setCss=function(css){this._itemrow.style.cssText+=";"+css;};EMenuItem.prototype.setDiableIcon=function(value){};EMenuItem.prototype.setCheckedIcon=function(img){this._checkedIcon=img?img:EPopupMenu.CONFIG.img.checked;};EMenuItem.prototype.getCheckedIcon=function(){return this._checkedIcon?this._checkedIcon:EPopupMenu.CONFIG.img.checked;};EMenuItem.prototype.setCheckGroup=function(p){if(this.owner){if(!this.owner.__checkGroups){this.owner.__checkGroups={};}this.__checkGroup=p;if(!this.owner.__checkGroups["chkGrp_"+this.__checkGroup]){this.owner.__checkGroups["chkGrp_"+this.__checkGroup]=[];}var rs=this.owner.__checkGroups["chkGrp_"+this.__checkGroup];rs.push(this);}};EMenuItem.prototype._processCheckGroup=function(){if(!this.owner||!this.owner.__checkGroups){return;}var rs=this.owner.__checkGroups["chkGrp_"+this.__checkGroup];if(!rs){return;}var f=this.__checkGroup.charAt(0)=="$";var tmp;for(var i=0,n=rs.length;i<n;i++){tmp=rs[i];if(tmp!=this){tmp.setChecked(false);continue;}this.setChecked(f?this.isChecked():true);}};EMenuItem.prototype.setChecked=function(f){this._checked=EUI.parseBool(f,false);this.hasChecked=true;this.setIcon(this._checked?this.getCheckedIcon():EPopupMenu.CONFIG.img.blank);};EMenuItem.prototype.isChecked=function(){return this._checked;};EMenuItem.prototype.getEMenuItemCount=function(){return this.__popupmenu?this.__popupmenu.getEMenuItemCount():0;};EMenuItem.prototype.getPopupmenu=function(){return this.__popupmenu?this.__popupmenu:null;};EMenuItem.prototype.getEMenuItem=function(iorname){return this.__popupmenu?this.__popupmenu.getEMenuItem(iorname):null;};EMenuItem.prototype.getMenuItem=EMenuItem.prototype.getEMenuItem;EMenuItem.prototype.addEMenuItem=function(caption,icon,onclick,oninit){var ownMenu=this.getOwner();if(!this.__popupmenu){this.setArrow(true);var isvert=ownMenu.isvert;var parentElement=undefined;if(isvert){parentElement=this.subcontainerdom;}this.__popupmenu=new EPopupMenu({wnd:this.owner.wnd,isvert:ownMenu.isvert,parentElement:parentElement});var container=this.__popupmenu.getContainer();var pmenuclass=ownMenu.getContainer().className;if(pmenuclass&&isvert){pmenuclass=pmenuclass.replace("eui-menu-container","").replace("eui-panel-hide","");container.className+=" "+pmenuclass;}isvert&&(container.style.position="relative");this.__popupmenu.setParentActiveEMenuItem(this);this.__popupmenu.setParent(this.getOwner());}return this.__popupmenu.addEMenuItem(caption,icon,onclick,oninit);};EMenuItem.prototype.addMenuItem=EMenuItem.prototype.addEMenuItem;EMenuItem.prototype.addMenus=function(menus){if(!menus){return;}if(this.__popupmenu){this.__popupmenu.dispose();}this.setArrow(true);this.__popupmenu=menus;this.__popupmenu.setParentActiveEMenuItem(this);this.__popupmenu.setParent(this.getOwner());};EMenuItem.prototype.hidden=function(){if(this.__popupmenu){this.__popupmenu.hidden();EUI.addClassName(this.subcontainerdom,"eui-hide");EUI.removeClassName(this._arrowimg,"eui-menu-expanded");}};EMenuItem.prototype.findEMenuItem=function(id){if(this.__popupmenu){return this.__popupmenu.findEMenuItem(id);}};EMenuItem.prototype.findMenuItem=EMenuItem.prototype.findEMenuItem;EMenuItem.prototype.removeEMenuItem=function(id){if(this.__popupmenu){return this.__popupmenu.removeEMenuItem(id);}};EMenuItem.prototype.removeMenuItem=EMenuItem.prototype.removeEMenuItem;EMenuItem.prototype.clear=function(){if(this.__popupmenu){return this.__popupmenu.clear();}};EMenuItem.prototype.addHr=function(){return this.__popupmenu?this.__popupmenu.addHr():null;};EMenuItem.prototype.removeHr=function(p){if(this.__popupmenu){this.__popupmenu.removeHr(p);}};EMenuItem.prototype.setHasChildEMenuItem=function(f){this.setArrow(f);};EMenuItem.prototype.setHasChildMenuItem=EMenuItem.prototype.setHasChildEMenuItem;EMenuItem.prototype.hasChildEMenuItem=function(){return this.__popupmenu!=null||this._hasArrow;};EMenuItem.prototype.hasChildMenuItem=EMenuItem.prototype.hasChildEMenuItem;EMenuItem.prototype.isChildMenuVisible=function(){return this.__popupmenu&&this.__popupmenu.isVisible();};EMenuItem.prototype.setInnerHTML=function(p){$(this._itemrow).empty();var $dom=$("<div>"+p+"</div>").appendTo(this._itemrow);return $dom[0];};EMenuItem.prototype.insertDOM=function(p){$(this._itemrow).empty();p=typeof(p)=="object"?p:$("#"+p)[0];this._itemrow.isInsertDOM=true;var $dom=$("<div></div>").appendTo(this._itemrow);$dom.append(p);return $dom[0];};EMenuItem.prototype.setOnClick=function(onclick){this.onclick=onclick;};EMenuItem.prototype.setOnPopupMenu=function(p){this.onpopupmenu=p;};EMenuItem.prototype.setOnInit=function(p){if(p&&typeof(p)=="function"){this.oninit=p;}};EMenuItem.prototype.doOnInit=function(){var self=this;if(this.oninit&&typeof(this.oninit)=="function"){this.oninit(self);}};EMenuItem.prototype.setArrow=function(f){this._hasArrow=typeof(f)=="boolean"?f:true;this._arrowimg.style.visibility=this._hasArrow?"visible":"hidden";};EMenuItem.prototype.hasArrow=function(){return this._hasArrow;};EMenuItem.prototype.getOwner=function(){return this.owner;};EMenuItem.prototype.setEnabled=function(f){var _disabled=!f;if(this.getContainer()._disabled==_disabled){return;}this.getContainer()._disabled=_disabled;this.highlightEMenuItem(false);var color=null,filter=null,opacity=null;if(_disabled){color="#CCC";opacity=".35";}else{color=opacity="";}this._itemrow.style.color=color;this._arrowimg.style.opacity=this._iconNode.style.opacity=opacity;};EMenuItem.prototype.isEnabled=function(){return !this.getContainer()._disabled;};EMenuItem.prototype.getId=function(){return this._itemrow.id;};return{EPopupMenu:EPopupMenu,EMenuItem:EMenuItem};});